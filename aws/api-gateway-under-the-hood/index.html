<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Api Gateway Under the Hood - Victor Ma</title><meta name=Description content="Victro Ma's blog"><meta property="og:title" content="Api Gateway Under the Hood"><meta property="og:description" content="底层设施 AWS API Gateway使用了多个分布式系统组件来提供其服务。这些组件包括 Amazon CloudFront、Amazon Route 53、AWS Elastic Load Balancing、AWS Lambda 等等。
当您创建一个 API Gateway 时，API Gateway 会在后台自动创建一个或多个 Amazon API Gateway REST API，并为每个 REST API 创建一个 Amazon CloudFront 分发。每个分发都有一个唯一的 DNS 名称，它充当 API 的公共入口点。
当客户端发送请求到 API Gateway 时，请求将被路由到正确的 Amazon CloudFront 分发。然后，Amazon CloudFront 将请求转发到与该 REST API 关联的 AWS Elastic Load Balancing 负载均衡器。负载均衡器将请求路由到一个或多个后端服务（如 AWS Lambda 函数或 EC2 实例）。
设计构架 RestApi 在整个 API Gateway 中，AWS::ApiGateway::RestApi 位于 API Gateway 的顶层，它表示整个 API 的定义和配置。
1 2 3 4  Endpoint:Type:AWS::ApiGateway::RestApiProperties:Name:Endpoint  这里仅仅是定义了 REST API 的名称，还没有定义 API 的具体资源和方法，因为它们需要使用 AWS::ApiGateway::Resource 和 AWS::ApiGateway::Method 资源类型进行定义。在定义了资源和方法之后，您需要使用 AWS::ApiGateway::Deployment 资源类型进行部署，才能将 API 置于生效状态。"><meta property="og:type" content="article"><meta property="og:url" content="https://decmaxn.github.io/aws/api-gateway-under-the-hood/"><meta property="og:image" content="https://decmaxn.github.io/logo.png"><meta property="article:published_time" content="2023-04-09T16:40:18-04:00"><meta property="article:modified_time" content="2023-04-24T01:01:49-04:00"><meta property="og:site_name" content="Victor Ma"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://decmaxn.github.io/logo.png"><meta name=twitter:title content="Api Gateway Under the Hood"><meta name=twitter:description content="底层设施 AWS API Gateway使用了多个分布式系统组件来提供其服务。这些组件包括 Amazon CloudFront、Amazon Route 53、AWS Elastic Load Balancing、AWS Lambda 等等。
当您创建一个 API Gateway 时，API Gateway 会在后台自动创建一个或多个 Amazon API Gateway REST API，并为每个 REST API 创建一个 Amazon CloudFront 分发。每个分发都有一个唯一的 DNS 名称，它充当 API 的公共入口点。
当客户端发送请求到 API Gateway 时，请求将被路由到正确的 Amazon CloudFront 分发。然后，Amazon CloudFront 将请求转发到与该 REST API 关联的 AWS Elastic Load Balancing 负载均衡器。负载均衡器将请求路由到一个或多个后端服务（如 AWS Lambda 函数或 EC2 实例）。
设计构架 RestApi 在整个 API Gateway 中，AWS::ApiGateway::RestApi 位于 API Gateway 的顶层，它表示整个 API 的定义和配置。
1 2 3 4  Endpoint:Type:AWS::ApiGateway::RestApiProperties:Name:Endpoint  这里仅仅是定义了 REST API 的名称，还没有定义 API 的具体资源和方法，因为它们需要使用 AWS::ApiGateway::Resource 和 AWS::ApiGateway::Method 资源类型进行定义。在定义了资源和方法之后，您需要使用 AWS::ApiGateway::Deployment 资源类型进行部署，才能将 API 置于生效状态。"><meta name=application-name content="Victor Ma"><meta name=apple-mobile-web-app-title content="Victor Ma"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://decmaxn.github.io/aws/api-gateway-under-the-hood/><link rel=prev href=https://decmaxn.github.io/aws/free-aws-ec2-instance/><link rel=next href=https://decmaxn.github.io/aws/free-aws-ec2-instance-by-cdk/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Api Gateway Under the Hood","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/decmaxn.github.io\/aws\/api-gateway-under-the-hood\/"},"image":["https:\/\/decmaxn.github.io\/images\/Apple-Devices-Preview.png"],"genre":"aws","keywords":"aws, tip","wordcount":352,"url":"https:\/\/decmaxn.github.io\/aws\/api-gateway-under-the-hood\/","datePublished":"2023-04-09T16:40:18-04:00","dateModified":"2023-04-24T01:01:49-04:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/decmaxn.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"Victor Ma"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Victor Ma">Victor Ma</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/python/>Python </a><a class=menu-item href=/go/>Go </a><a class=menu-item href=/k8s/>K8s </a><a class=menu-item href=/aws/>Aws </a><a class=menu-item href=/azure/>Azure </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/decmaxn title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw" aria-hidden=true></i></a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Victor Ma">Victor Ma</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/python/>Python</a><a class=menu-item href=/go/>Go</a><a class=menu-item href=/k8s/>K8s</a><a class=menu-item href=/aws/>Aws</a><a class=menu-item href=/azure/>Azure</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/>About</a><a class=menu-item href=https://github.com/decmaxn title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Api Gateway Under the Hood</h1><div class=content id=content><h2 id=底层设施>底层设施</h2><p>AWS API Gateway使用了多个分布式系统组件来提供其服务。这些组件包括 Amazon CloudFront、Amazon Route 53、AWS Elastic Load Balancing、AWS Lambda 等等。</p><p>当您创建一个 API Gateway 时，API Gateway 会在后台自动创建一个或多个 Amazon API Gateway REST API，并为每个 REST API 创建一个 Amazon CloudFront 分发。每个分发都有一个唯一的 DNS 名称，它充当 API 的公共入口点。</p><p>当客户端发送请求到 API Gateway 时，请求将被路由到正确的 Amazon CloudFront 分发。然后，Amazon CloudFront 将请求转发到与该 REST API 关联的 AWS Elastic Load Balancing 负载均衡器。负载均衡器将请求路由到一个或多个后端服务（如 AWS Lambda 函数或 EC2 实例）。</p><h2 id=设计构架>设计构架</h2><h3 id=restapi>RestApi</h3><p>在整个 API Gateway 中，AWS::ApiGateway::RestApi 位于 API Gateway 的顶层，它表示整个 API 的定义和配置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=k>Endpoint</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>RestApi<span class=w>
</span><span class=w>    </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>Name</span><span class=p>:</span><span class=w> </span>Endpoint<span class=w>
</span></code></pre></td></tr></table></div></div><p>这里仅仅是定义了 REST API 的名称，还没有定义 API 的具体资源和方法，因为它们需要使用 AWS::ApiGateway::Resource 和 AWS::ApiGateway::Method 资源类型进行定义。在定义了资源和方法之后，您需要使用 AWS::ApiGateway::Deployment 资源类型进行部署，才能将 API 置于生效状态。</p><h3 id=resource>Resource</h3><p>AWS::ApiGateway::Resource 是属于 AWS::ApiGateway::RestApi 的子资源类型，它表示一个特定的 API 资源 (请求路径)，例如 /users、/orders 等等。可以包含一个或多个子资源以及对应的方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=k>Endpointproxy39E2174E</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>Resource<span class=w>
</span><span class=w>    </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=c># 父资源 ID，即 Endpoint REST API 的根资源 ID</span><span class=w>
</span><span class=w>      </span><span class=k>ParentId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=c># Fn::GetAtt: [ logicalNameOfResource, attributeName ]</span><span class=w>
</span><span class=w>        </span><span class=k>Fn::GetAtt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- Endpoint<span class=w>
</span><span class=w>        </span><span class=c># The root resource ID for a RestApi resource, such as a0bc123d4e.</span><span class=w>
</span><span class=w>        </span>- RootResourceId<span class=w>
</span><span class=w>      </span><span class=c># 源的路径部分为 &#34;{proxy+}&#34;，它表示匹配任何请求路径</span><span class=w>
</span><span class=w>      </span><span class=c># The last path segment for this resource.</span><span class=w>
</span><span class=w>      </span><span class=k>PathPart</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{proxy+}&#34;</span><span class=w>
</span><span class=w>      </span><span class=c># The string identifier of the associated RestApi.</span><span class=w>
</span><span class=w>      </span><span class=k>RestApiId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>Endpoint<span class=w>
</span></code></pre></td></tr></table></div></div><h3 id=method>Method</h3><p>在 REST API 中，方法是资源的一部分，它定义了对资源的具体操作，例如 GET、POST、PUT 等等。每个方法都必须绑定到一个资源上，并且必须指定其对应的后端服务（例如 Lambda 函数或 EC2 实例）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=c># 定义一个任意 HTTP 方法的 API 方法，并将其与 Endpointproxy39E2174E 资源相关联，并将请求路由到一个 AWS Lambda 函数</span><span class=w>
</span><span class=w>  </span><span class=k>EndpointproxyANYC09721C5</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>Method<span class=w>
</span><span class=w>    </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=c># 指定该方法的 HTTP 请求方法，例如 GET、POST、PUT 等等</span><span class=w>
</span><span class=w>      </span><span class=k>HttpMethod</span><span class=p>:</span><span class=w> </span>ANY<span class=w>
</span><span class=w>      </span><span class=c># 指定该方法所属的资源的 ID。</span><span class=w>
</span><span class=w>      </span><span class=k>ResourceId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>Endpointproxy39E2174E<span class=w>
</span><span class=w>      </span><span class=c># 指定该方法所属的 REST API 的 ID。</span><span class=w>
</span><span class=w>      </span><span class=k>RestApiId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>Endpoint<span class=w>
</span><span class=w>      </span><span class=c># 可选属性，指定该方法的授权类型，例如 NONE、AWS_IAM 等等</span><span class=w>
</span><span class=w>      </span><span class=k>AuthorizationType</span><span class=p>:</span><span class=w> </span>NONE<span class=w>
</span><span class=w>      </span><span class=c># 指定该方法与后端服务的集成方式，它定义了将请求路由到哪个后端服务上。</span><span class=w>
</span><span class=w>      </span><span class=k>Integration</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=c># 使用 POST 方法将请求发送到后端 Lambda 函数。</span><span class=w>
</span><span class=w>        </span><span class=k>IntegrationHttpMethod</span><span class=p>:</span><span class=w> </span>POST<span class=w>
</span><span class=w>        </span><span class=c># AWS_PROXY 集成类型将通过 API Gateway 代理将所有 HTTP 请求传递给后端 Lambda 函数</span><span class=w>
</span><span class=w>        </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS_PROXY<span class=w>
</span><span class=w>        </span><span class=c># Lambda 函数的 ARN</span><span class=w>
</span><span class=w>        </span><span class=k>Uri</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>Fn::Join</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=s1>&#39;&#39;</span><span class=w>
</span><span class=w>          </span>- - <span class=s1>&#39;arn:&#39;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Ref</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>Partition<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;:apigateway:&#34;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Ref</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>Region<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;:lambda:path/2015-03-31/functions/&#34;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Fn::GetAtt</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- HelloHandler2E4FBA4D<span class=w>
</span><span class=w>              </span>- Arn<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;/invocations&#34;</span><span class=w>
</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=k>EndpointANY485C938B</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>Method<span class=w>
</span><span class=w>    </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>HttpMethod</span><span class=p>:</span><span class=w> </span>ANY<span class=w>
</span><span class=w>      </span><span class=k>ResourceId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Fn::GetAtt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- EndpointEEF1FD8F<span class=w>
</span><span class=w>        </span>- RootResourceId<span class=w>
</span><span class=w>      </span><span class=k>RestApiId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>EndpointEEF1FD8F<span class=w>
</span><span class=w>      </span><span class=k>AuthorizationType</span><span class=p>:</span><span class=w> </span>NONE<span class=w>
</span><span class=w>      </span><span class=k>Integration</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>IntegrationHttpMethod</span><span class=p>:</span><span class=w> </span>POST<span class=w>
</span><span class=w>        </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS_PROXY<span class=w>
</span><span class=w>        </span><span class=k>Uri</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>Fn::Join</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=s1>&#39;&#39;</span><span class=w>
</span><span class=w>          </span>- - <span class=s1>&#39;arn:&#39;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Ref</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>Partition<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;:apigateway:&#34;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Ref</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>Region<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;:lambda:path/2015-03-31/functions/&#34;</span><span class=w>
</span><span class=w>            </span>- <span class=k>Fn::GetAtt</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- HelloHandler2E4FBA4D<span class=w>
</span><span class=w>              </span>- Arn<span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;/invocations&#34;</span><span class=w>
</span></code></pre></td></tr></table></div></div><h3 id=deployment>Deployment</h3><p>创建 AWS::ApiGateway::Deployment 资源，用于部署 REST API 的变更</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>EndpointDeployment</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>Deployment<span class=w>
</span><span class=w>  </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=c># 指定要部署的 REST API 的 ID</span><span class=w>
</span><span class=w>    </span><span class=k>RestApiId</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>Endpoint<span class=w>
</span><span class=w>  </span><span class=c># 指定此 Deployment 资源所依赖的其他资源，即 EndpointproxyANYC09721C5、Endpointproxy39E2174E、EndpointANY485C938B</span><span class=w>
</span><span class=w>  </span><span class=k>DependsOn</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- EndpointproxyANYC09721C5<span class=w>
</span><span class=w>  </span>- Endpointproxy39E2174E<span class=w>
</span><span class=w>  </span>- EndpointANY485C938B<span class=w>
</span></code></pre></td></tr></table></div></div><h3 id=stage>Stage</h3><p>用于指定 API Gateway 的部署版本（EndpointDeployment）所使用的阶段名称。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=k>EndpointDeploymentStageprodB78BEEA0</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>Type</span><span class=p>:</span><span class=w> </span>AWS<span class=p>::</span>ApiGateway<span class=p>::</span>Stage<span class=w>
</span><span class=w>    </span><span class=k>Properties</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>RestApiId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>Endpoint<span class=w>
</span><span class=w>      </span><span class=c># DeploymentId 指定该阶段使用的部署版本</span><span class=w>
</span><span class=w>      </span><span class=k>DeploymentId</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>Ref</span><span class=p>:</span><span class=w> </span>EndpointDeployment<span class=w>
</span><span class=w>      </span><span class=k>StageName</span><span class=p>:</span><span class=w> </span>prod<span class=w>
</span></code></pre></td></tr></table></div></div><h2 id=这里只有一个生产环境测试环境呢>这里只有一个生产环境，测试环境呢？</h2><p>要测试环境，需要创建另一个部署，指向不同的 API 网关阶段。可以通过修改 CloudFormation 模板，将新的部署和阶段添加到模板中。然后使用 CloudFormation 更新堆栈，以创建并部署新的测试环境。在这个新的测试环境中，您可以测试 API 的新版本，而不会影响生产环境的稳定性。</p></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.68.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i>LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2012 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Victor Ma</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"en","pageSize":10,"placeholder":"Your comment ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>